(function(){var a={},d=null,e=false;function f(l,k){var m=this,j=Mustache.to_html(k,{locale:this.locale,translations:d[this.locale]});$(l).html(j);h.apply(this);$(".donation-form",l).submit(function(n){c.apply(this,[$(".prompt-input",l).val()]);$(".prompt-input",l).val("");n.preventDefault()}.bind(this))}function c(k){var j=this;$.ajax({url:this.donationUrl,dataType:"jsonp",data:{value:k,cause:this.cause},complete:function(l){h.apply(j)}})}function h(){var j=$(".prompt-stats .value",this.parent);if(j.length==1){$.ajax({url:this.statsUrl,data:{cause:this.cause},dataType:"jsonp"}).done(function(k){j.html(k)})}}function i(){setInterval(h.bind(this),10000)}function b(l){var j=function(){f.apply(this,[l,a[this.templateUrl]])}.bind(this);var m=this;if(a[this.templateUrl]!==null&&a[this.templateUrl]!==undefined){j()}else{if(a[m.templateUrl]===null){var k=setInterval(function(){if(a[m.templateUrl]!=null){clearInterval(k);j()}},50)}else{if(a[m.templateUrl]===undefined){a[m.templateUrl]=null;$.ajax({url:this.templateUrl,dataType:"html"}).done(function(n){a[m.templateUrl]=n;j()})}}}}var g=function(n,l){var m=function(){b.apply(this,[n]);i.apply(this)}.bind(this);var j=l.locale||"en_GB";this.parent=n;this.locale=j;this.cause=l.cause||"";this.donationUrl=l.donationUrl||"";this.statsUrl=l.statsUrl||"";this.templateUrl=l.templateUrl||"";if(!d&&!e){throw"Translations are needed to use the widget."}else{if(!e){m()}else{var k=setInterval(function(){if(!e){clearInterval(k);m()}},50)}}};g.loadTranslations=function(j){e=true;$.ajax({url:j,dataType:"jsonp",complete:function(k){d=k.responseJSON;e=false}})};window.Donate=g})();