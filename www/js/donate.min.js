(function(){var f={},d=null,a=false;function g(j,i){var k=this,h=Mustache.to_html(i,{locale:this.locale,translations:d[this.locale]});$(j).html(h);this.socket.on("stats",function(l){$(".prompt-stats .value",k.parent).html(l)});this.socket.emit("stats",this.cause);$(".donation-form",j).submit(function(l){c.apply(this,[$(".prompt-input",j).val()]);$(".prompt-input",j).val("");l.preventDefault()}.bind(this))}function c(i){var h=this;$.ajax({url:this.donationUrl,dataType:"jsonp",data:{value:i,cause:this.cause},complete:function(j){}})}function e(j){var h=function(){g.apply(this,[j,f[this.templateUrl]])}.bind(this);var k=this;if(f[this.templateUrl]!==null&&f[this.templateUrl]!==undefined){h()}else{if(f[k.templateUrl]===null){var i=setInterval(function(){if(f[k.templateUrl]!=null){clearInterval(i);h()}},50)}else{if(f[k.templateUrl]===undefined){f[k.templateUrl]=null;$.ajax({url:this.templateUrl,dataType:"html"}).done(function(l){f[k.templateUrl]=l;h()})}}}}var b=function(l,j){var k=function(){this.socket=new io.connect(this.socketUrl,{resource:"A/socket.io","force new connection":true,query:"cause="+this.cause});e.apply(this,[l])}.bind(this);var h=j.locale||"en_GB";this.parent=l;this.locale=h;this.cause=j.cause||"";this.donationUrl=j.donationUrl||"";this.socketUrl=j.socketUrl||"";this.templateUrl=j.templateUrl||"";if(!d&&!a){throw"Translations are needed to use the widget."}else{if(!a){k()}else{var i=setInterval(function(){if(!a){clearInterval(i);k()}},50)}}};b.loadTranslations=function(h){a=true;$.ajax({url:h,dataType:"jsonp",complete:function(i){d=i.responseJSON;a=false}})};window.Donate=b})();